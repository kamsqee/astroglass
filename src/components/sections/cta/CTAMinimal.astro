---
/**
 * CTA Minimal — The Marquee Statement (Premium Minimal)
 * 
 * An editorial CTA that combines:
 * - Infinite-scroll marquee ribbon with the headline repeating
 * - Oversized watermark typography in the background
 * - Scroll-triggered counter animation for social proof
 * - Premium action card with glassmorphic hover
 */
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

import '../../../styles/components/cta/CTAMinimal.css';
import '../../../styles/components/tag/TagMinimal.css';
---

<section class="cta-minimal relative py-24 lg:py-36 px-4 sm:px-6 overflow-hidden bg-base-100" data-cta-section>
  
  <!-- Oversized watermark typography -->
  <div class="absolute inset-0 pointer-events-none flex items-center justify-center overflow-hidden select-none" aria-hidden="true">
    <svg class="w-full h-auto max-h-[80%]" viewBox="0 0 1000 200" preserveAspectRatio="xMidYMid meet">
      <text x="50%" y="54%" dominant-baseline="middle" text-anchor="middle" font-size="160" font-weight="900" fill="currentColor" class="text-base-content/[0.02] tracking-tighter">
        START NOW
      </text>
    </svg>
  </div>

  <!-- Ambient glow -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-1/3 left-1/4 w-[500px] h-[300px] bg-accent/[0.04] rounded-full blur-[120px]"></div>
    <div class="absolute bottom-1/4 right-1/4 w-[400px] h-[250px] bg-accent/[0.03] rounded-full blur-[100px]"></div>
  </div>

  <!-- Marquee ribbon — edge to edge -->
  <div class="cta-minimal__marquee-wrap relative -mx-4 sm:-mx-6 mb-16 lg:mb-20 border-y border-base-content/5 py-4 sm:py-5 overflow-hidden">
    <div class="cta-minimal__marquee flex whitespace-nowrap">
      <div class="cta-minimal__marquee-text flex items-center px-4 sm:px-6">
        <svg viewBox="0 0 1600 35" class="h-6 sm:h-8 lg:h-10 w-auto" preserveAspectRatio="xMinYMid meet" aria-hidden="true">
          <text x="0" y="26" font-size="28" font-weight="900" fill="currentColor" class="text-base-content/[0.08] uppercase tracking-[0.1em]">
            {t('cta.title')} <tspan class="text-accent/20">✦</tspan> {t('cta.startBuilding')} <tspan class="text-accent/20">✦</tspan> {t('cta.title')} <tspan class="text-accent/20">✦</tspan> {t('cta.startBuilding')} <tspan class="text-accent/20">✦</tspan>
          </text>
        </svg>
      </div>
      <div class="cta-minimal__marquee-text flex items-center px-4 sm:px-6">
        <svg viewBox="0 0 1600 35" class="h-6 sm:h-8 lg:h-10 w-auto" preserveAspectRatio="xMinYMid meet" aria-hidden="true">
          <text x="0" y="26" font-size="28" font-weight="900" fill="currentColor" class="text-base-content/[0.08] uppercase tracking-[0.1em]">
            {t('cta.title')} <tspan class="text-accent/20">✦</tspan> {t('cta.startBuilding')} <tspan class="text-accent/20">✦</tspan> {t('cta.title')} <tspan class="text-accent/20">✦</tspan> {t('cta.startBuilding')} <tspan class="text-accent/20">✦</tspan>
          </text>
        </svg>
      </div>
    </div>
  </div>

  <div class="max-w-4xl mx-auto relative">

    <!-- Eyebrow -->
    <div class="text-center mb-6">
      <span class="cta-minimal__fade-in c-tag-minimal">
        <span class="c-tag-minimal__dash"></span>
        {t('cta.eyebrow')}
      </span>
    </div>

    <!-- Main headline — editorial scale -->
    <h2 class="cta-minimal__fade-in cta-minimal__headline text-center text-3xl sm:text-5xl md:text-6xl lg:text-7xl font-black text-base-content tracking-tight leading-[1.05] mb-5 lg:mb-6">
      {t('cta.title')}
    </h2>

    <!-- Subtitle -->
    <p class="cta-minimal__fade-in text-center text-sm sm:text-base lg:text-lg text-base-content/75 leading-relaxed max-w-lg mx-auto mb-10 lg:mb-14">
      {t('cta.subtitle')}
    </p>

    <!-- Animated counters row -->
    <div class="cta-minimal__fade-in flex items-center justify-center gap-6 sm:gap-10 lg:gap-14 mb-10 lg:mb-14">
      <div class="text-center">
        <div class="cta-minimal__counter text-2xl sm:text-3xl lg:text-4xl font-black text-base-content" data-target="50000" data-suffix="+">0</div>
        <div class="text-[10px] sm:text-xs text-base-content/80 uppercase tracking-[0.2em] mt-1 font-medium">{t('cta.stats.developers')}</div>
      </div>
      <div class="w-px h-8 sm:h-10 bg-base-content/8"></div>
      <div class="text-center">
        <div class="cta-minimal__counter text-2xl sm:text-3xl lg:text-4xl font-black text-base-content" data-target="99" data-suffix=".9%">0</div>
        <div class="text-[10px] sm:text-xs text-base-content/80 uppercase tracking-[0.2em] mt-1 font-medium">{t('cta.stats.uptime')}</div>
      </div>
      <div class="w-px h-8 sm:h-10 bg-base-content/8"></div>
      <div class="text-center">
        <div class="cta-minimal__counter text-2xl sm:text-3xl lg:text-4xl font-black text-base-content" data-target="10" data-suffix="x">0</div>
        <div class="text-[10px] sm:text-xs text-base-content/80 uppercase tracking-[0.2em] mt-1 font-medium">{t('cta.stats.faster')}</div>
      </div>
    </div>

    <!-- Premium action card -->
    <div class="cta-minimal__fade-in cta-minimal__card relative max-w-lg mx-auto p-6 sm:p-8 rounded-2xl sm:rounded-3xl bg-base-content/[0.02] border border-base-content/5 overflow-hidden group">
      <!-- Hover glow -->
      <div class="absolute -top-1/2 -left-1/2 w-full h-full bg-accent/[0.06] blur-[80px] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"></div>
      <div class="absolute -bottom-1/2 -right-1/2 w-full h-full bg-accent/[0.04] blur-[80px] rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-700 pointer-events-none"></div>
      
      <!-- Bottom accent line -->
      <div class="absolute bottom-0 left-0 w-0 h-[2px] bg-gradient-to-r from-accent/0 via-accent/40 to-accent/0 group-hover:w-full transition-all duration-1000 ease-out"></div>

      <div class="relative z-10">
        <!-- Buttons -->
        <div class="flex flex-col sm:flex-row gap-3 mb-5">
          <a href={`/${locale}/pricing`} class="cta-minimal__btn group/btn relative flex-1 px-6 py-3.5 sm:py-4 rounded-xl bg-accent text-base-100 font-bold text-sm text-center overflow-hidden transition-all duration-500 hover:shadow-[0_12px_40px_rgba(var(--a),0.3)]">
            <span class="relative z-10 flex items-center justify-center gap-2">
              {t('cta.primary')}
              <svg class="w-4 h-4 translate-x-0 group-hover/btn:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6"/>
              </svg>
            </span>
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/15 to-transparent -translate-x-full group-hover/btn:translate-x-full transition-transform duration-700"></div>
          </a>
          <a href={`/${locale}/docs`} class="flex-1 px-6 py-3.5 sm:py-4 rounded-xl border border-base-content/10 text-base-content/75 font-medium text-sm text-center hover:bg-base-content/[0.03] hover:border-base-content/15 transition-all duration-400">
            {t('cta.secondary')}
          </a>
        </div>

        <!-- Trust strip -->
        <div class="flex flex-wrap items-center justify-center gap-4 text-base-content/25 text-xs">
          <span class="flex items-center gap-1.5">
            <svg class="w-3.5 h-3.5 text-accent/40" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            {t('cta.trialDays')}
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="w-3.5 h-3.5 text-accent/40" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            {t('cta.noCreditCard')}
          </span>
          <span class="flex items-center gap-1.5">
            <svg class="w-3.5 h-3.5 text-accent/40" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
            {t('cta.cancelAnytime')}
          </span>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  function initCTAMinimal() {
    const section = document.querySelector('[data-cta-section]');
    if (!section) return;

    // Staggered fade-in
    const fadeEls = section.querySelectorAll('.cta-minimal__fade-in');
    const sectionObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          fadeEls.forEach((el, i) => {
            setTimeout(() => el.classList.add('visible'), i * 100);
          });
          sectionObserver.disconnect();
        }
      });
    }, { threshold: 0.15 });
    sectionObserver.observe(section);

    // Counter animation
    const counters = section.querySelectorAll('.cta-minimal__counter');
    const counterObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          counters.forEach(counter => {
            const target = parseInt(counter.getAttribute('data-target') || '0');
            const suffix = counter.getAttribute('data-suffix') || '';
            const duration = 2000;
            const startTime = performance.now();

            function easeOutExpo(t: number): number {
              return t === 1 ? 1 : 1 - Math.pow(2, -10 * t);
            }

            function animate(currentTime: number) {
              const elapsed = currentTime - startTime;
              const progress = Math.min(elapsed / duration, 1);
              const easedProgress = easeOutExpo(progress);
              const current = Math.floor(easedProgress * target);
              
              if (target >= 1000) {
                counter.textContent = current.toLocaleString() + suffix;
              } else {
                counter.textContent = current + suffix;
              }

              if (progress < 1) {
                requestAnimationFrame(animate);
              }
            }

            requestAnimationFrame(animate);
          });
          counterObserver.disconnect();
        }
      });
    }, { threshold: 0.3 });

    const counterRow = counters[0]?.closest('div');
    if (counterRow) counterObserver.observe(counterRow);
  }

  initCTAMinimal();
  document.addEventListener('astro:after-swap', initCTAMinimal);
</script>
