---
/**
 * Pricing Neo - The Spotlight Carousel
 * One plan in focus at a time with smooth crossfade transitions.
 */
import '../../../styles/components/pricing/PricingNeo.css';
import NeoSectionTag from '../../ui/neo/NeoSectionTag.astro';
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const plans = [
  {
    id: 'starter',
    name: t('pricing.tier1Name'),
    tagline: t('pricing.plans.starter.tagline'),
    price: '0',
    period: t('pricing.freeForever'),
    desc: t('pricing.plans.starter.desc'),
    features: [t('pricing.features.projects'), t('pricing.values.community'), t('pricing.features.support'), t('pricing.features.analytics'), '1 GB ' + t('pricing.features.storage')],
    color: 'emerald',
    icon: 'üå±'
  },
  {
    id: 'pro',
    name: t('pricing.tier2Name'),
    tagline: t('pricing.plans.pro.tagline'),
    price: '49',
    period: t('pricing.perMonth'),
    desc: t('pricing.plans.pro.desc'),
    features: [t('pricing.values.unlimited'), t('pricing.values.priorityEmail'), t('pricing.features.customThemes'), t('pricing.features.analytics'), '50 GB ' + t('pricing.features.storage'), t('pricing.features.apiAccess')],
    color: 'violet',
    icon: '‚ö°',
    popular: true
  },
  {
    id: 'enterprise',
    name: t('pricing.tier3Name'),
    tagline: t('pricing.plans.enterprise.tagline'),
    price: '199',
    period: t('pricing.perMonth'),
    desc: t('pricing.plans.enterprise.desc'),
    features: [t('pricing.plans.pro.tagline'), t('pricing.features.dedicatedNodes'), t('pricing.values.phone247'), t('pricing.features.customSla'), '500 GB ' + t('pricing.features.storage'), t('pricing.features.whiteLabel'), t('pricing.features.securityAudit'), t('pricing.features.teamTraining')],
    color: 'amber',
    icon: 'üè¢'
  },
];
---



<section id="pricing" class="pricing-neo-section relative py-32 lg:py-48 px-6 overflow-hidden min-h-screen flex items-center bg-base-100">
  <!-- Background glow layers for each tier -->
  <div class="absolute inset-0 pointer-events-none">
     <div class="c-pricing-neo__bg-layer active" data-tier="0" style="--layer-bg: radial-gradient(ellipse at center, rgba(16, 185, 129, 0.1) 0%, transparent 70%);"></div>
     <div class="c-pricing-neo__bg-layer" data-tier="1" style="--layer-bg: radial-gradient(ellipse at center, rgba(139, 92, 246, 0.1) 0%, transparent 70%);"></div>
     <div class="c-pricing-neo__bg-layer" data-tier="2" style="--layer-bg: radial-gradient(ellipse at center, rgba(245, 158, 11, 0.1) 0%, transparent 70%);"></div>
  </div>
  
  <div class="max-w-7xl mx-auto w-full relative z-10">
    <!-- Header -->
    <div class="text-center mb-16 lg:mb-24">
       <NeoSectionTag label={t('pricing.choosePath')} class="mb-4" />
       <h2 class="text-5xl md:text-7xl lg:text-8xl font-black text-base-content tracking-tighter leading-none">{t('pricing.title')}</h2>
    </div>

    <!-- Desktop: Spotlight Layout -->
    <div class="hidden lg:grid grid-cols-12 gap-12 items-center min-h-[600px]">
       <!-- Navigation Pills (Left) -->
       <div class="col-span-2 flex flex-col gap-4">
          {plans.map((p, i) => (
             <button 
               class:list={["c-pricing-neo__nav-btn text-left px-6 py-5 rounded-2xl border", i === 1 ? "active" : ""]}
               data-index={i}
             >
                <span class="text-2xl mb-2 block">{p.icon}</span>
                <span class="text-[10px] font-black uppercase tracking-[0.3em] text-base-content/75 block">{p.name}</span>
             </button>
          ))}
       </div>

       <!-- Main Spotlight Card (Center) - All plans stacked, one visible -->
       <div class="col-span-6 relative min-h-[580px]">
          {plans.map((p, i) => (
             <div 
               class:list={["c-pricing-neo__card absolute top-0 left-0 right-0", i === 1 ? "active" : ""]}
               data-plan={i}
             >
                <div class:list={[
                  "relative p-16 rounded-[4rem] bg-base-content/[0.03] backdrop-blur-[80px] border border-base-content/10 shadow-2xl overflow-hidden min-h-[550px]",
                  p.color === 'emerald' ? "c-pricing-neo__glow--emerald" : p.color === 'violet' ? "c-pricing-neo__glow--violet" : "c-pricing-neo__glow--amber"
                ]}>
                   
                   {p.popular && (
                      <div class="absolute top-8 right-8 px-5 py-2 bg-accent text-base-100 text-[9px] font-black uppercase tracking-[0.3em] rounded-full shadow-lg">
                         {t('pricing.popular')}
                      </div>
                   )}

                   <div class="relative z-10">
                      <div class="mb-10">
                         <span class="text-6xl mb-6 block">{p.icon}</span>
                         <span class="text-[11px] font-black uppercase tracking-[0.5em] text-accent block mb-4">{p.tagline}</span>
                         <h3 class="text-4xl font-black text-base-content tracking-tight mb-4">{p.name}</h3>
                      </div>

                      <div class="mb-10">
                         <div class="flex items-baseline gap-2 mb-2">
                            <span class="text-base-content/20 text-3xl font-black">$</span>
                            <span class="text-8xl font-black text-base-content tracking-tighter">{p.price}</span>
                         </div>
                         <p class="text-sm text-base-content/80 font-medium">{p.period}</p>
                      </div>

                      <p class="text-lg text-base-content/75 font-medium leading-relaxed mb-12 max-w-md">
                         {p.desc}
                      </p>

                      <button class="spotlight-cta px-14 py-5 rounded-2xl bg-accent text-base-100 font-black text-xs uppercase tracking-[0.3em] shadow-xl hover:scale-105 active:scale-95 transition-all duration-500">
                         {t('pricing.cta')}
                      </button>
                   </div>
                </div>
             </div>
          ))}
       </div>

       <!-- Features Panel (Right) -->
       <div class="col-span-4">
          <div class="p-10 rounded-[3rem] bg-base-content/[0.02] border border-base-content/5">
             <h4 class="text-[10px] font-black uppercase tracking-[0.4em] text-base-content/80 mb-8">{t('pricing.featuresTitle')}</h4>
             {plans.map((p, i) => (
                <ul 
                  class:list={["c-pricing-neo__features space-y-4", i === 1 ? "active" : ""]}
                  data-features={i}
                >
                   {p.features.map(f => (
                      <li class="flex items-center gap-3 text-sm font-medium text-base-content/75">
                         <div class="w-2 h-2 rounded-full bg-accent/60"></div>
                         {f}
                      </li>
                   ))}
                </ul>
             ))}
          </div>
       </div>
    </div>

    <!-- Mobile: Horizontal Swipe Carousel -->
    <div class="lg:hidden">
       <div class="c-pricing-neo__mobile-carousel flex gap-4 overflow-x-auto snap-x snap-mandatory pb-6 -mx-6 px-6 scrollbar-hide">
          {plans.map((p, idx) => (
             <div class:list={[
                "c-pricing-neo__mobile-card flex-shrink-0 w-[85vw] snap-center p-8 rounded-[2.5rem] border backdrop-blur-xl relative overflow-hidden",
                p.popular ? "bg-base-content/[0.05] border-accent/30" : "bg-base-content/[0.02] border-base-content/10"
             ]}>
                <!-- Gradient accent -->
                <div class:list={[
                   "absolute inset-0 opacity-20 pointer-events-none",
                   p.color === 'emerald' ? "bg-gradient-to-br from-emerald-500/30 to-transparent" :
                   p.color === 'violet' ? "bg-gradient-to-br from-violet-500/30 to-transparent" :
                   "bg-gradient-to-br from-amber-500/30 to-transparent"
                ]}></div>
                
                {p.popular && (
                   <div class="absolute top-4 right-4 px-4 py-1.5 bg-accent text-base-100 text-[8px] font-black uppercase tracking-[0.2em] rounded-full">
                      {t('pricing.popular')}
                   </div>
                )}

                <div class="relative z-10">
                   <div class="flex items-center gap-4 mb-6">
                      <span class="text-4xl">{p.icon}</span>
                      <div>
                         <span class="text-[9px] font-black uppercase tracking-[0.4em] text-accent block">{p.tagline}</span>
                         <h3 class="text-xl font-black text-base-content tracking-tight">{p.name}</h3>
                      </div>
                   </div>
                   
                   <div class="flex items-baseline gap-1 mb-4">
                      <span class="text-base-content/20 text-xl font-black">$</span>
                      <span class="text-5xl font-black text-base-content tracking-tighter">{p.price}</span>
                      <span class="text-xs text-base-content/80 font-medium ml-2">{p.period}</span>
                   </div>

                   <p class="text-sm text-base-content/75 font-medium leading-relaxed mb-6">{p.desc}</p>

                   <div class="flex flex-wrap gap-2 mb-6">
                      {p.features.slice(0, 3).map(f => (
                         <span class="px-3 py-1.5 rounded-full bg-base-content/5 text-[10px] font-bold text-base-content/75">
                            {f}
                         </span>
                      ))}
                      {p.features.length > 3 && (
                         <span class="px-3 py-1.5 rounded-full bg-accent/10 text-[10px] font-bold text-accent">
                            +{p.features.length - 3} more
                         </span>
                      )}
                   </div>

                   <button class:list={[
                      "w-full py-4 rounded-xl font-black text-[10px] uppercase tracking-[0.2em]",
                      p.popular ? "bg-accent text-base-100" : "bg-base-content/5 text-base-content"
                   ]}>
                      {t('pricing.cta')}
                   </button>
                </div>
             </div>
          ))}
       </div>
       <!-- Carousel indicators -->
       <div class="flex justify-center gap-2 mt-4">
          {plans.map((_, idx) => (
             <div class:list={[
                "w-2 h-2 rounded-full transition-all",
                idx === 1 ? "bg-accent w-6" : "bg-base-content/20"
             ]}></div>
          ))}
       </div>
    </div>
  </div>
</section>

<script>
  function initSpotlightNeo() {
    const navBtns = document.querySelectorAll('.c-pricing-neo__nav-btn');
    const planCards = document.querySelectorAll('.c-pricing-neo__card');
    const featuresLists = document.querySelectorAll('.c-pricing-neo__features');
    const bgLayers = document.querySelectorAll('.c-pricing-neo__bg-layer');

    function setActive(index: number) {
      // Update nav buttons
      navBtns.forEach((btn, i) => btn.classList.toggle('active', i === index));
      
      // Update plan cards (crossfade)
      planCards.forEach((card, i) => card.classList.toggle('active', i === index));
      
      // Update features lists
      featuresLists.forEach((list, i) => list.classList.toggle('active', i === index));
      
      // Update background layers
      bgLayers.forEach((layer, i) => layer.classList.toggle('active', i === index));

      if ('vibrate' in navigator) navigator.vibrate(10);
    }

    navBtns.forEach((btn, i) => {
      btn.addEventListener('click', () => setActive(i));
    });
  }

  // Init with Pro (index 1) which is default, but the script ensures it's set.
  // Actually the HTML markup has index 1 hardcoded as active for some elements but not others?
  // Let's rely on the script to set initial state or leave as is.
  // The original script called setActive(1) immediately.
  // We'll trust the original logic but update class selection.

  initSpotlightNeo();
  document.addEventListener('astro:after-swap', initSpotlightNeo);
</script>
