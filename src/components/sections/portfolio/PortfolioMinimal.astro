---
/**
 * Portfolio Minimal - Vertical Stage
 */
import '../../../styles/components/portfolio/PortfolioPageMinimal.css';
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';
import LocalizedLink from '../../ui/LocalizedLink.astro';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const projects = [
  { id: 1, title: t('portfolio.p1Title'), num: '01' },
  { id: 2, title: t('portfolio.p2Title'), num: '02' },
  { id: 3, title: t('portfolio.p3Title'), num: '03' },
  { id: 4, title: t('portfolio.p4Title'), num: '04' },
];
import '../../../styles/components/tag/TagMinimal.css';
---

<section id="portfolio" class="relative py-32 px-6">
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-24"><span class="c-tag-minimal"><span class="c-tag-minimal__dash"></span>{t('portfolio.title')}</span></div>

    <div class="space-y-4">
       {projects.map((p) => (
          <div class="c-portfolio-page-minimal__row group relative border-b border-base-content/5 overflow-hidden transition-all duration-700">
             {/* Destop Overlay Link */}
             <LocalizedLink href="/minimal/portfolio" class="absolute inset-0 z-20 hidden md:block" aria-label={`View project ${p.title}`}></LocalizedLink>

             {/* Mobile Toggle Button */}
             <button 
                class="absolute inset-0 z-20 md:hidden w-full h-full cursor-pointer focus:outline-none"
                aria-label={`Expand project ${p.title}`}
                onclick={`
                   const parent = this.closest('.c-portfolio-page-minimal__row');
                   const content = parent.querySelector('.c-portfolio-expanded');
                   const icon = parent.querySelector('.c-portfolio-icon');
                   
                   // Close all other rows
                   document.querySelectorAll('.c-portfolio-expanded').forEach(el => {
                      if (el !== content) {
                         el.style.maxHeight = null;
                         el.style.opacity = '0';
                         el.style.marginTop = '0';
                         el.closest('.c-portfolio-page-minimal__row').querySelector('.c-portfolio-icon')?.classList.remove('rotate-180');
                      }
                   });

                   // Toggle current
                   if (content.style.maxHeight) {
                      content.style.maxHeight = null;
                      content.style.opacity = '0';
                      content.style.marginTop = '0';
                      icon?.classList.remove('rotate-180');
                   } else {
                      content.style.maxHeight = content.scrollHeight + "px";
                      content.style.opacity = '1';
                      content.style.marginTop = '1.5rem';
                      icon?.classList.add('rotate-180');
                   }
                `}
             ></button>

             <div class="relative z-30 flex flex-col py-8 md:py-12 px-2 pointer-events-none">
                <div class="flex items-center justify-between w-full">
                   <div class="flex items-center gap-6 md:gap-12">
                      <span class="text-2xl md:text-6xl font-thin text-base-content/10 md:group-hover:text-accent md:group-hover:font-black transition-all duration-1000">{p.num}</span>
                      <h3 class="text-3xl md:text-9xl font-black text-base-content tracking-tighter transition-all duration-1000 md:group-hover:translate-x-6">{p.title}</h3>
                   </div>
                   
                   {/* Mobile Expansion Indicator */}
                   <div class="md:hidden c-portfolio-icon transition-transform duration-300">
                      <svg class="w-6 h-6 text-base-content/80" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                   </div>
                </div>

                {/* Mobile Expanded Content */}
                <div class="c-portfolio-expanded max-h-0 opacity-0 overflow-hidden transition-all duration-500 ease-in-out md:hidden">
                    <div class="pt-4 pb-2">
                        <p class="text-base-content/75 text-sm mb-6 leading-relaxed max-w-[90%]">
                           Experience standard-setting design and engineering. Tap to explore the full case study.
                        </p>
                        <LocalizedLink href="/minimal/portfolio" class="relative z-30 inline-flex items-center gap-3 px-6 py-3 bg-base-content text-base-100 rounded-full text-sm font-bold tracking-wide uppercase pointer-events-auto">
                           <span>{t('portfolio.viewProject')}</span>
                           <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                        </LocalizedLink>
                    </div>
                </div>
             </div>

             {/* Floating Preview Image (Abstract Glass Card) - Desktop Only */}
             <div class="absolute right-[5%] top-1/2 -translate-y-1/2 w-80 h-48 bg-accent/10 backdrop-blur-3xl rounded-3xl overflow-hidden border border-accent/20 opacity-0 scale-50 -rotate-6 md:group-hover:opacity-100 md:group-hover:scale-100 md:group-hover:rotate-6 transition-all duration-[1200ms] cubic-bezier(0.16, 1, 0.3, 1) hidden lg:block pointer-events-none shadow-2xl">
                <div class="absolute inset-0 bg-gradient-to-tr from-accent/20 to-transparent"></div>
             </div>
             
             {/* Desktop Arrow */}
             <div class="absolute right-0 top-1/2 -translate-y-1/2 z-10 hidden md:block opacity-0 md:group-hover:opacity-100 transition-opacity duration-1000 pr-12 pointer-events-none">
                <div class="w-16 h-16 rounded-full border border-base-content/20 flex items-center justify-center">
                   <svg class="w-6 h-6 text-accent" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
                </div>
             </div>
          </div>
       ))}
    </div>
  </div>
</section>

<script>
  import { registerAstroPage } from '../../../utils/lifecycle';
  import { initScrollReveal } from '../../../utils/animations';

  registerAstroPage((signal) => {
    initScrollReveal('.c-portfolio-page-minimal__row', {
      threshold: 0.1,
      rootMargin: '0px 0px -40px 0px',
      staggerMs: 100,
      signal,
    });
  });
</script>
