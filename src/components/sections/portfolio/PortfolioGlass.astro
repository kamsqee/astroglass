---
/**
 * Portfolio Glass - Kinetic Horizon (Refined)
 * Horizontal scrolling with category tags and better hints.
 */
import '../../../styles/components/portfolio/PortfolioPageGlass.css';
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';
import LocalizedLink from '../../ui/LocalizedLink.astro';
import SectionTag from '../../ui/glass/SectionTag.astro';
import SectionHeading from '../../ui/glass/SectionHeading.astro';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const projects = [
  { id: 1, title: t('portfolio.p1Title'), desc: t('portfolio.p1Desc'), category: t('portfolio.categories.webapp'), num: '01' },
  { id: 2, title: t('portfolio.p2Title'), desc: t('portfolio.p2Desc'), category: t('portfolio.categories.dashboard'), num: '02' },
  { id: 3, title: t('portfolio.p3Title'), desc: t('portfolio.p3Desc'), category: t('portfolio.categories.mobile'), num: '03' },
  { id: 4, title: t('portfolio.p4Title'), desc: t('portfolio.p4Desc'), category: t('portfolio.categories.branding'), num: '04' },
];
---

<section id="portfolio" class="relative py-16 sm:py-24 md:py-32 bg-base-content/[0.01] overflow-hidden">
  <!-- Header -->
  <div class="px-4 sm:px-6 mb-10 sm:mb-14 max-w-7xl mx-auto flex flex-col sm:flex-row sm:items-end justify-between gap-4">
    <div>
      <SectionTag label={t('portfolio.gallery')} class="mb-3" />
      <SectionHeading size="lg" class="leading-none">
        {t('portfolio.title')}
      </SectionHeading>
    </div>
    <p class="text-sm sm:text-base text-base-content/75 max-w-xs">
      {t('portfolio.subtitle')}
    </p>
  </div>

  <!-- Carousel -->
  <div class="relative">
    <div class="c-portfolio-glass__container flex gap-4 sm:gap-6 px-4 sm:px-6 lg:px-[8vw] pt-10 pb-16 sm:pb-20 overflow-x-auto snap-x snap-mandatory">
      {projects.map((p, i) => (
        <div class="c-portfolio-glass__item group flex-shrink-0 w-[85vw] sm:w-[50vw] lg:w-[35vw] aspect-[3/4] sm:aspect-[3/4] relative snap-center" style={`animation-delay: ${i * 100}ms`}>
          <div class="absolute inset-0 bg-base-content/[0.02] backdrop-blur-xl border border-base-content/10 rounded-2xl sm:rounded-3xl overflow-hidden shadow-xl transition-all duration-700 group-hover:scale-[1.02] group-hover:shadow-2xl group-hover:border-accent/20">
            <!-- Gradient overlay -->
            <div class="absolute inset-0 bg-gradient-to-tr from-accent/10 via-transparent to-primary/10 opacity-0 group-hover:opacity-100 transition-opacity duration-700"></div>
            
            <div class="relative z-10 h-full p-6 sm:p-8 lg:p-10 flex flex-col justify-between">
              <!-- Top -->
              <div class="flex items-start justify-between">
                <span class="px-3 py-1.5 rounded-lg bg-accent/10 text-accent text-[10px] font-bold uppercase tracking-wider">
                  {p.category}
                </span>
                <span aria-hidden="true" class="text-4xl sm:text-5xl font-black text-base-content/5 group-hover:text-base-content/10 transition-colors duration-500">{p.num}</span>
              </div>
              
              <!-- Bottom -->
              <div>
                <h3 class="text-2xl sm:text-3xl lg:text-4xl font-black text-base-content mb-2 sm:mb-3 tracking-tight group-hover:text-accent transition-colors duration-500">
                  {p.title}
                </h3>
                <p class="text-sm sm:text-base text-base-content/75 font-medium max-w-md mb-4 sm:mb-6 group-hover:text-base-content/75 transition-colors duration-500">
                  {p.desc}
                </p>
                <LocalizedLink href="/glass/portfolio" class="inline-flex items-center gap-3 text-accent font-bold text-xs uppercase tracking-widest hover:gap-5 transition-all duration-300">
                  {t('portfolio.viewProject')}
                  <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"/>
                  </svg>
                </LocalizedLink>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
    
    <!-- Scroll hint controls -->
    <div class="flex items-center justify-center gap-4 mt-4 pb-4">
      <button id="portfolio-glass-prev" aria-label="Scroll left" class="p-2 text-base-content/80 hover:text-accent transition-all hover:-translate-x-1 outline-none focus-visible:ring-2 focus-visible:ring-accent rounded-full flex-shrink-0">
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 12H5M12 19l-7-7 7-7"/>
        </svg>
      </button>
      <span class="text-[10px] font-bold uppercase tracking-widest text-base-content whitespace-nowrap">{t('portfolio.scrollHint')}</span>
      <button id="portfolio-glass-next" aria-label="Scroll right" class="p-2 text-base-content/80 hover:text-accent transition-all hover:translate-x-1 outline-none focus-visible:ring-2 focus-visible:ring-accent rounded-full flex-shrink-0">
        <svg class="w-5 h-5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"/>
        </svg>
      </button>
    </div>
  </div>
</section>

<script>
  function initPortfolioGlassScroll() {
    const container = document.querySelector('#portfolio .c-portfolio-glass__container');
    const prevBtn = document.getElementById('portfolio-glass-prev');
    const nextBtn = document.getElementById('portfolio-glass-next');

    if (!container || !prevBtn || !nextBtn) return;

    const scrollAmount = window.innerWidth * 0.6; // Scroll mostly 60vw to align next card

    const handlePrev = () => container.scrollBy({ left: -scrollAmount, behavior: 'smooth' });
    const handleNext = () => container.scrollBy({ left: scrollAmount, behavior: 'smooth' });

    prevBtn.addEventListener('click', handlePrev);
    nextBtn.addEventListener('click', handleNext);
  }

  initPortfolioGlassScroll();
  document.addEventListener('astro:after-swap', initPortfolioGlassScroll);
</script>
