---
/**
 * Hero Glass - Infinite Tunnel
 * A deep perspective tunnel of frosted glass cards with micro-interactions.
 */
import '../../../styles/components/hero/HeroGlass.css';
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

import { buttonVariants } from '../../ui/button';
import { cn } from '../../../lib/utils';
import SectionTag from '../../ui/glass/SectionTag.astro';
import SectionHeading from '../../ui/glass/SectionHeading.astro';

const titleParts = t('hero.title').split(' ');
const lastTwo = titleParts.length > 2 ? titleParts.slice(-2).join(' ') : '';
const remaining = titleParts.length > 2 ? titleParts.slice(0, -2).join(' ') : t('hero.title');

// Generate 15 random particles for ambient depth
const particles = Array.from({ length: 15 }).map((_, i) => ({
  id: i,
  left: `${Math.random() * 100}%`,
  top: `${Math.random() * 100}%`,
  delay: `${Math.random() * 10}s`,
  duration: `${Math.random() * 5 + 10}s`
}));
---

<section 
  id="hero-glass-tunnel"
  class="relative min-h-screen flex items-center justify-center overflow-hidden px-4 sm:px-6 lg:px-16 pt-[calc(100px+var(--nav-offset))] pb-24 md:py-32"
>
  <!-- Background Ambient Orbs -->
  <div class="absolute inset-0 z-0 overflow-hidden pointer-events-none">
    <div class="absolute top-1/4 right-0 w-[60%] h-[70%] bg-[hsl(var(--glow-color))] opacity-[var(--glow-intensity,0.12)] blur-[160px] rounded-full translate-x-1/4 animate-pulse-slow"></div>
    <div class="absolute bottom-0 left-1/4 w-[40%] h-[50%] bg-accent/20 blur-[140px] rounded-full -translate-x-1/4 animate-pulse-slow mix-blend-screen mix-blend-plus-lighter" style="animation-duration: 7s;"></div>
  </div>

  <div class="c-hero-glass__tunnel-container w-full h-full flex items-center justify-center relative z-10">
    <div id="c-hero-glass__tunnel" class="relative w-[92vw] max-w-5xl h-[520px] sm:h-[650px] lg:h-[700px] transform-style-3d transition-transform duration-200 ease-out">
      
      <!-- Deepest Particles -->
      <div class="absolute inset-0 z-0 pointer-events-none transform translate-z-[-500px] opacity-30">
        {particles.slice(0, 5).map(p => (
           <div class="c-hero-glass__particle" style={`left: ${p.left}; top: ${p.top}; animation-delay: ${p.delay}; animation-duration: ${p.duration};`}></div>
        ))}
      </div>

      <!-- Layer 4 (Deepest) -->
      <div class="absolute inset-x-4 inset-y-6 sm:inset-x-12 sm:inset-y-16 border border-white/5 dark:border-white/5 border-t-white/10 dark:border-t-white/10 rounded-[2rem] sm:rounded-[4rem] bg-base-300 text-base-content backdrop-blur-[2px] transform translate-z-[-400px] sm:translate-z-[-600px] scale-[0.6] sm:scale-75 opacity-10 flex items-center justify-center shadow-[0_0_100px_rgba(255,255,255,0.02)_inset]"></div>
      
      <!-- Layer 3 -->
      <div class="absolute inset-x-2 inset-y-4 sm:inset-x-8 sm:inset-y-12 border border-white/10 dark:border-white/10 border-t-white/15 dark:border-t-white/20 rounded-[2.5rem] sm:rounded-[4rem] bg-base-content/[0.01] backdrop-blur-sm transform translate-z-[-250px] sm:translate-z-[-400px] scale-[0.75] sm:scale-85 opacity-30 flex items-center justify-center shadow-[0_0_80px_rgba(255,255,255,0.05)_inset]"></div>
      
      <!-- Layer 2 -->
      <div class="absolute inset-x-1 inset-y-2 sm:inset-x-4 sm:inset-y-6 border border-white/20 dark:border-white/15 border-t-white/30 dark:border-t-white/30 rounded-[2.75rem] sm:rounded-[4rem] bg-base-content/[0.02] backdrop-blur-md transform translate-z-[-100px] sm:translate-z-[-200px] scale-[0.9] sm:scale-95 opacity-70 flex items-center justify-center shadow-[0_0_60px_rgba(255,255,255,0.1)_inset] overflow-hidden">
        <!-- Occasional animated sweep on trailing card -->
        <div class="absolute inset-0 c-hero-glass__sweep pointer-events-none mix-blend-overlay"></div>
      </div>

      <!-- Mid Particles -->
      <div class="absolute inset-0 z-10 pointer-events-none transform translate-z-[-50px] sm:translate-z-[-100px] opacity-60">
        {particles.slice(5, 10).map(p => (
           <div class="c-hero-glass__particle" style={`left: ${p.left}; top: ${p.top}; animation-delay: ${p.delay}; animation-duration: ${p.duration};`}></div>
        ))}
      </div>
      
      <!-- Layer 1 (Front focus layer) -->
      <div class="absolute inset-0 z-20 border border-white/30 dark:border-white/20 border-t-white/50 dark:border-t-white/40 rounded-[3rem] sm:rounded-[4rem] bg-base-content/[0.04] backdrop-blur-2xl sm:backdrop-blur-3xl transform translate-z-0 flex flex-col items-center justify-center p-6 sm:p-12 md:p-16 lg:p-20 text-center shadow-[0_20px_40px_rgba(0,0,0,0.15),0_0_30px_rgba(255,255,255,0.1)_inset] sm:shadow-[0_30px_60px_rgba(0,0,0,0.2),0_0_40px_rgba(255,255,255,0.15)_inset] overflow-hidden">
        
        <!-- Front animated sweep -->
        <div class="absolute inset-0 c-hero-glass__sweep pointer-events-none mix-blend-overlay opacity-30 sm:opacity-50" style="animation-delay: 2s"></div>

        <!-- Badge -->
        <SectionTag label={t('hero.digitalExperience')} class="mb-5 sm:mb-6 lg:mb-10 animate-fade-in relative z-10 scale-90 sm:scale-100" />

        <SectionHeading tag="h1" size="xl" align="center" class="mb-4 sm:mb-6 lg:mb-8 leading-[1.05] sm:leading-[1.1] max-w-[95%] sm:max-w-4xl mx-auto drop-shadow-md text-balance relative z-10">
          {remaining} 
          {lastTwo && (
            <span class="inline-block text-transparent bg-clip-text bg-gradient-to-r from-base-content to-base-content/40 ml-1 sm:ml-2 drop-shadow-sm">{lastTwo}</span>
          )}
        </SectionHeading>

        <p class="text-base sm:text-lg md:text-xl lg:text-2xl text-base-content/75 max-w-[95%] sm:max-w-2xl mx-auto mb-8 sm:mb-12 leading-relaxed font-medium text-balance relative z-10">
          {t('hero.subtitle')}
        </p>

        <div class="flex flex-col sm:flex-row gap-3 sm:gap-6 justify-center w-[90%] sm:w-auto mx-auto relative z-10">
          <a class={cn(buttonVariants({ variant: "liquid", size: "liquid" }), "c-hero-glass__btn-liquid-glass w-full sm:w-auto overflow-hidden group")} href="#services">
            <div class="absolute inset-0 bg-accent translate-y-full group-hover:translate-y-0 transition-transform duration-700 ease-out"></div>
            <!-- tiny sweep on button hover -->
            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-[150%] skew-x-[-30deg] group-hover:animate-[sweep_1.5s_ease-out_0.5s]"></div>
            <span class="relative z-10 text-sm sm:text-base">{t('hero.cta')}</span>
          </a>
          <a class={cn(buttonVariants({ variant: "liquid-secondary", size: "liquid" }), "c-hero-glass__btn-liquid-secondary-glass w-full sm:w-auto")} href="#portfolio">
            <span class="text-sm sm:text-base">{t('hero.watchReel')}</span>
            <div class="c-hero-glass__play-icon w-8 h-8 sm:w-10 sm:h-10 rounded-full bg-base-content/5 flex items-center justify-center group-hover:bg-accent group-hover:text-base-100 transition-all duration-500">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="sm:w-[18px] sm:h-[18px]" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>
            </div>
          </a>
        </div>
      </div>

      <!-- Front Particles mapping -->
      <div class="absolute inset-0 z-30 pointer-events-none transform translate-z-[100px]">
        {particles.slice(10, 15).map(p => (
           <div class="c-hero-glass__particle" style={`left: ${p.left}; top: ${p.top}; animation-delay: ${p.delay}; animation-duration: ${p.duration}; transform: scale(1.5)`}></div>
        ))}
      </div>

    </div>
  </div>
</section>

<style>
  .transform-style-3d { transform-style: preserve-3d; }
  .translate-z-\[-600px\] { transform: translateZ(-600px); }
  .translate-z-\[-500px\] { transform: translateZ(-500px); }
  .translate-z-\[-400px\] { transform: translateZ(-400px); }
  .translate-z-\[-200px\] { transform: translateZ(-200px); }
  .translate-z-\[-100px\] { transform: translateZ(-100px); }
  .translate-z-0 { transform: translateZ(0); }
  .translate-z-\[100px\] { transform: translateZ(100px); }
</style>

<script>
  // Setup mouse tracking for the tunnel
  const initTunnel = () => {
    const tunnel = document.getElementById('c-hero-glass__tunnel');
    const section = document.getElementById('hero-glass-tunnel');

    if (tunnel && section) {
      section.addEventListener('mousemove', (e) => {
        // Only trigger rich tracking on non-touch devices
        if (window.matchMedia("(any-hover: hover)").matches) {
          const rect = section.getBoundingClientRect();
          const x = e.clientX - rect.left;
          const y = e.clientY - rect.top;
          
          const centerX = rect.width / 2;
          const centerY = rect.height / 2;
          
          const rotateX = ((y - centerY) / centerY) * -15;
          const rotateY = ((x - centerX) / centerX) * 15;

          tunnel.style.transform = `rotateX(${rotateX}deg) rotateY(${rotateY}deg)`;
        }
      });
      
      section.addEventListener('mouseleave', () => {
        if (window.matchMedia("(any-hover: hover)").matches) {
          tunnel.style.transform = `rotateX(0deg) rotateY(0deg)`;
          tunnel.style.transition = 'transform 0.5s ease-out';
        }
      });
      
      section.addEventListener('mouseenter', () => {
        if (window.matchMedia("(any-hover: hover)").matches) {
          tunnel.style.transition = 'transform 0.1s linear';
        }
      });
    }
  };

  // Run on load and after ViewTransitions
  initTunnel();
  document.addEventListener('astro:page-load', initTunnel);
</script>
