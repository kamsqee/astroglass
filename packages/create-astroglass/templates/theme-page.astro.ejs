---
<%# [theme].astro — generated by create-astroglass CLI %>
/**
 * Dynamic Theme Page — Landing Route
 *
 * Generates /{theme} for each enabled theme via getStaticPaths().
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import { useTranslations } from '../../utils/i18n';
import { getLocaleFromUrl } from '../../utils/locale-utils';
import { getThemeById } from '../../config/themes';
import { themePresets } from '../../config/themePresets';

// Theme barrel files
<% themes.forEach(theme => { %>
import * as <%= theme.id.charAt(0).toUpperCase() + theme.id.slice(1) %>Sections from '../../components/sections/themes/<%= theme.id %>';
<% }) %>

type ThemeModuleMap = Record<string, Record<string, unknown>>;

export async function getStaticPaths() {
  const { getEnabledThemes } = await import('../../config/themes');
  const { getEnabledLocaleCodes, defaultLocale } = await import('../../config/locales');
  const themes = getEnabledThemes();
  const langs = getEnabledLocaleCodes();
  const paths = [];

  for (const lang of langs) {
    for (const theme of themes) {
      paths.push({
        params: {
          lang: lang === defaultLocale ? undefined : lang,
          theme: theme.id
        },
        props: { themeId: theme.id }
      });
    }
  }
  return paths;
}

interface Props {
  themeId: string;
}

const { themeId } = Astro.props;
const theme = getThemeById(themeId);
const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const preset = themePresets[themeId] ?? themePresets['<%= themes[0].id %>'];

// Map theme IDs to their header version numbers for correct --nav-offset
const themeHeaderVersions: Record<string, number> = {
<% themes.forEach(theme => { %>
  <%= theme.id %>: <%= theme.version %>,
<% }) %>
};

const themeModules: ThemeModuleMap = {
<% themes.forEach(theme => { %>
  <%= theme.id %>: <%= theme.id.charAt(0).toUpperCase() + theme.id.slice(1) %>Sections,
<% }) %>
};

const sections = themeModules[themeId] ?? <%= themes[0].id.charAt(0).toUpperCase() + themes[0].id.slice(1) %>Sections;

const Header = sections['Header'] as (_props: Record<string, unknown>) => unknown;
const Footer = sections['Footer'] as (_props: Record<string, unknown>) => unknown;

const mainSections = preset.landingSections
  .map((key) => sections[key] ?? null)
  .filter((C): C is NonNullable<typeof C> => C !== null);
---

<BaseLayout
  title={`${theme?.name} Theme - ${t('title')}`}
  description={t('description')}
  showHeader={false}
  headerVersion={themeHeaderVersions[themeId] ?? <%= themes[0].version %>}
>
  <Header />
  <main>
    {mainSections.map((Section: any) => <Section />)}
  </main>
  <Footer />
</BaseLayout>

