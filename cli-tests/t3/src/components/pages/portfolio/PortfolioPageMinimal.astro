---
/**
 * Portfolio Page — Minimal Theme (Composition Layer)
 * 
 * Wires data ↔ sub-components:
 *   - PortfolioHeroMinimal → gradient text hero + filters
 *   - PortfolioRowsMinimal → horizontal rows + inline detail panels
 *   - PortfolioCTAMinimal  → bottom CTA
 */
import '../../../styles/components/portfolio/PortfolioPageMinimal.css';
import '../../../styles/components/tag/TagMinimal.css';
import { useTranslations } from '../../../utils/i18n';
import { getLocaleFromUrl } from '../../../utils/locale-utils';

import PortfolioHeroMinimal from './minimal/PortfolioHeroMinimal.astro';
import PortfolioRowsMinimal from './minimal/PortfolioRowsMinimal.astro';
import PortfolioCTAMinimal from './minimal/PortfolioCTAMinimal.astro';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const localePrefix = locale === 'en' ? '' : `/${locale}`;
const minimalBase = `${localePrefix}/minimal`;

const categories = [
  { id: 'all', label: t('portfolioPage.filterAll') },
  { id: 'webapp', label: t('portfolio.categories.webapp') },
  { id: 'dashboard', label: t('portfolio.categories.dashboard') },
  { id: 'mobile', label: t('portfolio.categories.mobile') },
  { id: 'branding', label: t('portfolio.categories.branding') },
];

const projects = [
  {
    id: 'p1',
    title: t('portfolioPage.projects.p1.title'),
    description: t('portfolioPage.projects.p1.description'),
    category: 'webapp',
    categoryLabel: t('portfolioPage.projects.p1.category'),
    challenge: t('portfolioPage.projects.p1.challenge'),
    solution: t('portfolioPage.projects.p1.solution'),
    impact: t('portfolioPage.projects.p1.impact'),
    techStack: ['React', 'Node.js', 'GraphQL', 'Redis', 'AWS'],
    metric: t('portfolioPage.projects.p1.metric'),
    metricLabel: t('portfolioPage.projects.p1.metricLabel'),
    num: '01',
  },
  {
    id: 'p2',
    title: t('portfolioPage.projects.p2.title'),
    description: t('portfolioPage.projects.p2.description'),
    category: 'dashboard',
    categoryLabel: t('portfolioPage.projects.p2.category'),
    challenge: t('portfolioPage.projects.p2.challenge'),
    solution: t('portfolioPage.projects.p2.solution'),
    impact: t('portfolioPage.projects.p2.impact'),
    techStack: ['Vue.js', 'D3.js', 'Python', 'PostgreSQL', 'Docker'],
    metric: t('portfolioPage.projects.p2.metric'),
    metricLabel: t('portfolioPage.projects.p2.metricLabel'),
    num: '02',
  },
  {
    id: 'p3',
    title: t('portfolioPage.projects.p3.title'),
    description: t('portfolioPage.projects.p3.description'),
    category: 'mobile',
    categoryLabel: t('portfolioPage.projects.p3.category'),
    challenge: t('portfolioPage.projects.p3.challenge'),
    solution: t('portfolioPage.projects.p3.solution'),
    impact: t('portfolioPage.projects.p3.impact'),
    techStack: ['Swift', 'SwiftUI', 'Firebase', 'Lottie', 'CoreData'],
    metric: t('portfolioPage.projects.p3.metric'),
    metricLabel: t('portfolioPage.projects.p3.metricLabel'),
    num: '03',
  },
  {
    id: 'p4',
    title: t('portfolioPage.projects.p4.title'),
    description: t('portfolioPage.projects.p4.description'),
    category: 'branding',
    categoryLabel: t('portfolioPage.projects.p4.category'),
    challenge: t('portfolioPage.projects.p4.challenge'),
    solution: t('portfolioPage.projects.p4.solution'),
    impact: t('portfolioPage.projects.p4.impact'),
    techStack: ['Three.js', 'GSAP', 'WebGL', 'Astro', 'Cloudflare'],
    metric: t('portfolioPage.projects.p4.metric'),
    metricLabel: t('portfolioPage.projects.p4.metricLabel'),
    num: '04',
  },
  {
    id: 'p5',
    title: t('portfolioPage.projects.p5.title'),
    description: t('portfolioPage.projects.p5.description'),
    category: 'webapp',
    categoryLabel: t('portfolioPage.projects.p5.category'),
    challenge: t('portfolioPage.projects.p5.challenge'),
    solution: t('portfolioPage.projects.p5.solution'),
    impact: t('portfolioPage.projects.p5.impact'),
    techStack: ['Next.js', 'OpenAI', 'Prisma', 'Supabase', 'Vercel'],
    metric: t('portfolioPage.projects.p5.metric'),
    metricLabel: t('portfolioPage.projects.p5.metricLabel'),
    num: '05',
  },
  {
    id: 'p6',
    title: t('portfolioPage.projects.p6.title'),
    description: t('portfolioPage.projects.p6.description'),
    category: 'dashboard',
    categoryLabel: t('portfolioPage.projects.p6.category'),
    challenge: t('portfolioPage.projects.p6.challenge'),
    solution: t('portfolioPage.projects.p6.solution'),
    impact: t('portfolioPage.projects.p6.impact'),
    techStack: ['Remix', 'Shopify Hydrogen', 'Three.js', 'Stripe', 'Edge Functions'],
    metric: t('portfolioPage.projects.p6.metric'),
    metricLabel: t('portfolioPage.projects.p6.metricLabel'),
    num: '06',
  },
];
---

<PortfolioHeroMinimal
  categories={categories}
  titleLabel={t('portfolio.title')}
  pageTitle={t('portfolioPage.pageTitle')}
  pageSubtitle={t('portfolioPage.pageSubtitle')}
/>

<PortfolioRowsMinimal
  projects={projects}
  challengeLabel={t('portfolioPage.theChallenge')}
  solutionLabel={t('portfolioPage.theSolution')}
  impactLabel={t('portfolioPage.theImpact')}
  techStackLabel={t('portfolioPage.techStackLabel')}
  closeDetailsLabel={t('portfolioPage.closeDetails')}
/>

<PortfolioCTAMinimal
  startProjectLabel={t('portfolioPage.startProject')}
  startProjectSubLabel={t('portfolioPage.startProjectSub')}
  backToHomeLabel={t('portfolioPage.backToHome')}
  contactHref={`${minimalBase}#contact`}
  homeHref={minimalBase}
/>

<script>
  import { registerAstroPage } from '../../../utils/lifecycle';
  import { initScrollReveal } from '../../../utils/animations';
  import { initCategoryFilter, initDetailPanels } from '../../../utils/portfolio';

  registerAstroPage((signal) => {
    if (!document.querySelector('.c-portfolio-page-minimal__row')) return;

    initDetailPanels({
      toggleSelector: '[data-toggle-details]',
      closeSelector: '[data-close-details]',
      panelBaseSelector: '.c-portfolio-page-minimal__details',
      cardSelector: '.c-portfolio-page-minimal__item',
      signal,
    });

    initScrollReveal('.c-portfolio-page-minimal__row', {
      threshold: 0.1,
      rootMargin: '0px 0px -40px 0px',
      staggerMs: 100,
      signal,
    });

    initCategoryFilter({
      filtersId: 'pp-minimal-filters',
      cardSelector: '.c-portfolio-page-minimal__item',
      activeClasses: ['border-accent', 'text-accent', 'bg-accent/10'],
      inactiveClasses: ['border-base-content/10', 'text-base-content/80'],
      twoStepAnimation: true,
      hideTransform: 'translateY(20px) scale(0.98)',
      animateChildSelector: '.c-portfolio-page-minimal__row',
      signal,
    });
  });
</script>
