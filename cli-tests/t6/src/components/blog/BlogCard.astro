---
import { useTranslations } from '../../utils/i18n';
import { getLocaleFromUrl } from '../../utils/locale-utils';
import LocalizedLink from '../ui/LocalizedLink.astro';
import '../../styles/components/blog/BlogCard.css';

interface Props {
  post: any;
}

const { post } = Astro.props;
const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const slug = post.slug.replace(/^[a-z]{2}\//, '');
const href = `/blog/${slug}/`;
const date = new Intl.DateTimeFormat(locale, { dateStyle: 'medium' }).format(post.data.date);

const readingTime = post.data.readingTime || Math.max(1, Math.ceil(post.body.split(/\s+/).length / 200));
const hasCover = !!post.data.cover;
---

<LocalizedLink href={href} class={`blog-card ${hasCover ? '' : 'blog-card--no-image'}`}>
  {hasCover && (
    <div class="blog-card__image-wrap">
      <img src={post.data.cover.src} alt="" loading="lazy" />
      {post.data.category && (
        <span class="blog-card__category">{post.data.category}</span>
      )}
    </div>
  )}
  <div class="blog-card__body">
    {!hasCover && post.data.tags.length > 0 && (
      <div class="blog-card__tags">
        {post.data.tags.map((tag: string) => (
          <span class="blog-card__tag">{tag}</span>
        ))}
      </div>
    )}
    <h3 class="blog-card__title">{post.data.title}</h3>
    <p class="blog-card__excerpt">{post.data.description}</p>
    <div class="blog-card__footer">
      <span class="blog-card__author">{post.data.author}</span>
      <span>
        <time datetime={post.data.date.toISOString()}>{date}</time>
        {' Â· '}
        <span class="blog-card__reading-time">{readingTime} {t('blog.minRead')}</span>
      </span>
    </div>
  </div>
</LocalizedLink>
