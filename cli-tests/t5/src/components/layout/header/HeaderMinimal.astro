---
/**
 * HeaderMinimal â€” Fullscreen Overlay Navigation
 *
 * The "Invisible" Header. A burger button opens a dramatic fullscreen overlay
 * with large typography links, expandable children, and settings.
 */
import { getLocaleFromUrl, useTranslations } from '../../../utils/i18n';
import LocalizedLink from '../../ui/LocalizedLink.astro';
import { buildMinimalNavLinks } from '../../../config/navigation';
import LanguageSwitcher from '../../ui/LanguageSwitcher.astro';
import { palettes } from '../../../config/palettes';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);
const navLinks = buildMinimalNavLinks(t);
import '../../../styles/components/header/HeaderMinimal.css';
---

<header class="header-minimal">
  <LocalizedLink href="/" class="logo-minimal">
    {t('siteName')}<span>.</span>
  </LocalizedLink>

  <button class="burger-minimal" id="trigger-minimal" aria-label={t('nav.menu')}>
    <div class="burger-minimal-box">
      <div class="burger-minimal-inner"></div>
    </div>
  </button>
</header>

<div class="panel-minimal" id="panel-minimal">
  <div class="panel-minimal-bg">
    <div class="minimal-blob"></div>
    <div class="minimal-blob"></div>
  </div>
  
  <div class="panel-minimal-content">
    <div class="panel-minimal-header">
       <div class="panel-minimal-label">{t('nav.explore')}</div>
    </div>

    <nav class="panel-minimal-nav">
      {navLinks.map((link, index) => (
        <LocalizedLink href={link.href} class="panel-minimal-link" data-index={index}>
          <span class="panel-minimal-link-text">{link.label}</span>
          {link.label}
        </LocalizedLink>
      ))}
    </nav>

    <div class="panel-minimal-settings">
       <div class="minimal-settings-group">
          <span class="minimal-settings-label">{t('nav.preferences')}</span>
          <div class="minimal-theme-grid">
             {palettes.map(p => (
               <button class="minimal-theme-btn" data-theme-minimal={p.id} title={p.id.charAt(0).toUpperCase() + p.id.slice(1)}>{p.icon}</button>
             ))}
          </div>
       </div>
       <div class="minimal-settings-group">
          <span class="minimal-settings-label">{t('languageSwitcher.label')}</span>
          <LanguageSwitcher variant="mobile" />
       </div>
    </div>

    <div class="panel-minimal-footer">
      <div class="panel-minimal-footer-info">
        <p>&copy; 2026 {t('siteName')}</p>
      </div>
      <div class="panel-minimal-socials">
        <!-- Replace with your social links -->
        <a href="https://twitter.com" target="_blank" rel="noopener noreferrer" aria-label={t('nav.socials.twitter')}>TW</a>
        <a href="https://github.com" target="_blank" rel="noopener noreferrer" aria-label={t('nav.socials.github')}>GH</a>
      </div>
    </div>
  </div>
</div>

<script>
  function initHeaderMinimal() {
    const trigger = document.getElementById('trigger-minimal');
    const panel = document.getElementById('panel-minimal');
    
    if (!trigger || !panel) return;

    // Reset state
    panel.classList.remove('is-open');
    trigger.classList.remove('is-active');

    const closeMenu = () => {
      panel.classList.remove('is-open');
      trigger.classList.remove('is-active');
      document.body.style.overflow = '';
    };

    const openMenu = () => {
      panel.classList.add('is-open');
      trigger.classList.add('is-active');
      document.body.style.overflow = 'hidden';
    };

    trigger.addEventListener('click', () => {
      panel.classList.contains('is-open') ? closeMenu() : openMenu();
    });

    // Close on nav link click (not group triggers)
    panel.querySelectorAll('.panel-minimal-link, .panel-minimal-child-link').forEach(link => {
      link.addEventListener('click', closeMenu);
    });

    // Escape key handler
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && panel.classList.contains('is-open')) {
        closeMenu();
        trigger.focus();
      }
    });

    // Theme buttons
    panel.querySelectorAll('[data-theme-minimal]').forEach(btn => {
      btn.addEventListener('click', () => {
        const theme = btn.getAttribute('data-theme-minimal');
        if (theme) {
          document.documentElement.setAttribute('data-theme', theme);
          localStorage.setItem('theme', theme);
        }
      });
    });

    // Expandable groups
    panel.querySelectorAll('[data-minimal-group]').forEach(group => {
      const groupTrigger = group.querySelector('.panel-minimal-group-trigger');
      if (!groupTrigger) return;

      groupTrigger.addEventListener('click', () => {
        group.classList.toggle('is-open');
      });
    });
  }

  initHeaderMinimal();
  document.addEventListener('astro:after-swap', initHeaderMinimal);
</script>
