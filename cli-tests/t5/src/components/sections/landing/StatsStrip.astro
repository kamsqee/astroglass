---
/**
 * Stats Strip — Key metrics in a horizontal strip
 * Social proof numbers: themes, components, sections, languages, edge-ready
 */
import '../../../styles/components/landing/StatsStrip.css';
import { getLocaleFromUrl, useTranslations } from '../../../utils/i18n';

const locale = getLocaleFromUrl(Astro.url);
const t = useTranslations(locale);

const stats = [
  { value: '6', label: t('landing.stats.themes'), accent: true },
  { value: '66+', label: t('landing.stats.components'), accent: false },
  { value: '12+', label: t('landing.stats.sections'), accent: false },
  { value: '10', label: t('landing.stats.palettes'), accent: false },
  { value: '7', label: t('landing.stats.languages'), accent: false },
  { value: '✓', label: t('landing.stats.edge'), accent: true },
];
---

<section id="stats" class="stats-strip">
  <div class="stats-strip-inner">
    {stats.map((stat, i) => (
      <div class="stats-strip-item" style={`animation-delay: ${i * 0.1}s`}>
        <span
          class:list={["stats-strip-value", stat.accent && "stats-strip-value--accent"]}
          {...(stat.value.match(/^\d/) ? { 'data-count': stat.value } : {})}
        >
          {stat.value.match(/^\d/) ? '0' : stat.value}
        </span>
        <span class="stats-strip-label">{stat.label}</span>
      </div>
    ))}
  </div>
</section>




<script>
  function initStatsCountUp() {
    const strip = document.querySelector('.stats-strip');
    if (!strip) return;

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            strip.classList.add('in-view');
            // Count up numeric values
            strip.querySelectorAll('[data-count]').forEach((el) => {
              const target = el.getAttribute('data-count') || '0';
              const numMatch = target.match(/^(\d+)/);
              if (!numMatch) return;
              const end = parseInt(numMatch[1], 10);
              const suffix = target.replace(/^\d+/, '');
              const duration = 1200;
              const startTime = performance.now();

              function tick(now: number) {
                const elapsed = now - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease out cubic
                const eased = 1 - Math.pow(1 - progress, 3);
                const current = Math.round(end * eased);
                el.textContent = current + suffix;
                if (progress < 1) requestAnimationFrame(tick);
              }
              requestAnimationFrame(tick);
            });
            observer.unobserve(entry.target);
          }
        });
      },
      { threshold: 0.3 }
    );

    observer.observe(strip);
  }

  initStatsCountUp();
  document.addEventListener('astro:after-swap', initStatsCountUp);
</script>

